<!doctype html><html lang=zh-tw>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>透過 SSH key pair 登入遠端伺服器 &#183; My New Hugo Site</title>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/fonts.css>
<link rel=icon href=favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/images/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/images/favicon-16x16.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<link href rel=alternate type=application/rss+xml title="My New Hugo Site">
</head>
<body>
<nav class=nav>
<div class=nav-container>
<a href=/>
<h2 class=nav-title>My New Hugo Site</h2>
</a>
<ul>
</ul>
</div>
</nav>
<main>
<div class=post>
<div class=post-info>
<span>Written by</span>
<br>
<span>on&nbsp;</span><time datetime="2019-12-29 22:10:38 +0800 +0800">December 29, 2019</time>
</div>
<h1 class=post-title>透過 SSH key pair 登入遠端伺服器</h1>
<div class=post-line></div>
<h2 id=前言>前言</h2>
<p>這篇文件在介紹如何建立ssh的金鑰組並透過這組金鑰登入遠端的伺服器，來解決使用VS Code直接遠端開發時會需要一直輸入密碼的困擾。</p>
<h2 id=1-建立金鑰>1. 建立金鑰</h2>
<p>首先要建立一組金鑰，打開terminal輸入</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssh-keygen -t ed25519
</code></pre></div><p><code>-t</code>可以指定演算法。
接著會詢問你要儲存的地方和名稱，直接按enter跳過的話，預設會存在使用者目錄下的<code>.ssh</code>目錄下。
名稱會是：</p>
<ul>
<li>public key <code>id_ed25519.pub</code></li>
<li>private key <code>id_ed25519</code></li>
</ul>
<p>同時還會詢問你是否要設定<code>passphrase</code>，像是通關密語。有設定的話，使用這把key登入時就要輸入。這邊可以直接按enter跳過。</p>
<h2 id=2-放到遠端伺服器>2. 放到遠端伺服器</h2>
<p>當建立好public key和private key後，接下來只要透過<code>ssh-copy-id</code>將public key安裝到遠端伺服器上就完成了。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssh-copy-id -i ~/.ssh/your_key.pub user@host
</code></pre></div><p><code>user@host</code>改成你的帳號和遠端伺服器的ip或domain。</p>
<h2 id=3-使用private-key登入遠端伺服器>3. 使用private key登入遠端伺服器</h2>
<p>當上述步驟都完成後可以直接透過 <code>-i</code> 指定private key的位置ssh登入遠端伺服器。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssh -i ~/.ssh/your_key user@host
</code></pre></div><h2 id=人生不如意十之八九>人生不如意十之八九</h2>
<p>當前兩步驟做完後第三步驟卻還是無法登入時可以看看遠端伺服器的sshd可能沒有設定接受public key的驗證方式，檢查伺服器的<code>/etc/ssh/sshd_config</code>檔案中有看到下面這行</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>PubkeyAuthentication yes
</code></pre></div><p>如果是 <code>false</code> 的話改完重啟<code>sshd</code>服務，再試試看。
如果還是不行，在伺服器端可以使用</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>sshd -d
</code></pre></div><p>開啟debug模式，看看是哪邊的問題。詳細內容參考 <a href=https://www.ssh.com/academy/ssh/sshd>sshd</a></p>
</div>
<div class=pagination>
<a href=# class=top>Top</a>
</div>
</main>
<footer>
<span>
&copy; <time datetime="2022-01-20 15:10:40.756662879 +0000 UTC m=+0.041849846">2022</time> . Made with <a href=https://gohugo.io>Hugo</a> using the <a href=https://github.com/EmielH/tale-hugo/>Tale</a> theme.
</span>
</footer>
</body>
</html>